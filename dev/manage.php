<?php include "head.php"; ?>
<div class="navbar-fixed">
  <nav>
    <div class="nav-wrapper waves-light">
      <a href="#" class="brand-logo center">Manage</a>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
      <ul id="nav-mobile" class="left hide-on-med-and-down">
        <li><a href="index.php">Profil</a></li>
        <li class="active"><a href="manage.php">Manage Engine &amp; Database</a></li>
        <li><a href="logout.php">Logout</a></li>
      </ul>
      <ul class="side-nav" id="mobile-demo">
        <li><a href="index.php">Profil</a></li>
        <li><a href="manage.php">Manage Engine &amp; Database</a></li>
        <li><a href="logout.php">Logout</a></li>
      </ul>
    </div>
  </nav>
</div>

<div class="container" style="margin-top: 50px;">

<h4>Engine</h4>
  
  <?php if ($engine_id != NULL) { ?>
<div class="card-panel">
  <ul class="collection">
    <li class="collection-item avatar">
      <i class="material-icons circle red">flash_on</i>
      <b class="title"><?php echo $engine_name; ?></b>
      <p>Jumlah Database :  <span class="light"><?php echo GetCountDB('../' . $engine_file); ?> </span></p>
      <p>Diperbarui pada :  <span class="light"> <?php echo $engine_update; ?></span></p>
      <?php if(GetValidParams('../' . $engine_file, $engine_params) === false) {echo "<p class='rd'>Invalid params, tolong periksa kembali data parameters anda..!</p>"; } ?>
      <a href="download.php?f=<?php echo $eid; ?>" class="secondary-content"><i class="material-icons">input</i></a>    
    </li>
  </ul>
    </div>

  <?php } else {?>

  <form action="add_engine.php" method="POST" enctype="multipart/form-data">
  <div class="card-panel">
      <div class="row">
        <div class="input-field col s9">
          <input placeholder="Project name" disabled value="<?php echo $projname; ?>" type="text" class="validate" required="true">
          <label for="disabled">Project Name</label>
        </div>
        <div class="input-field col s2">
          <input placeholder="Ex =" name="params" maxlength="1" minlength="1" type="text" value="=" class="validate center" required="true">
          <label for="params">Params</label>
        </div>
      </div>

    <div class="file-field input-field">
      <div class="btn red">
        <span>File</span>
        <input type="file" required="true" name="dbfile" id="dbfile" accept="text/*">
      </div>
      <div class="file-path-wrapper">
        <input class="file-path validate" type="text">
      </div>
    </div>
    Style (*sesuai letak yang ada di database anda)
    <p>
      <input name="delim" id="cek1" type="radio" checked value="1"/>
      <label for="cek1">HASH [delim] Nama_Virus</label>
    </p>
    <p>
      <input name="delim" id="cek2" type="radio" value="2"/>
      <label for="cek2">Nama_Virus [delim] HASH</label>
    </p>
  </div>
  <button class="btn-floating btn-large waves-effect waves-light red" type="submit" name="add"><i class="material-icons">add</i></button>
  </form>
  <?php goto loncat; } ?>
 
  <div class="fixed-action-btn horizontal click-to-toggle" style="bottom: 45px; right: 24px;">
    <a class="btn-floating waves-effect waves-light btn-large red">
      <i class="material-icons">menu</i>
    </a>
    <ul>
      <li><a class="btn-floating green" id="edit"><i class="material-icons">mode_edit</i></a></li>
      <li><a class="btn-floating red" id="delete"><i class="material-icons">delete</i></a></li>
    </ul>
  </div>
  <?php loncat: ?>      


 </div>
 <script type="text/javascript">
    $('#dbfile').bind('change', function() {
       var ukur = this.files[0].size;
        if(ukur >= 8999608) {  
          alert('File terlalu besar..!');
          $('#userfile').val('');
          return false;
        }
    });
    $(document).ready(function() {
      $('#delete').click(function() {
          var c = confirm('Yakin ingin dihapus?');
          if(c === false) {return false;} 
          $.post('delete.php', { action: 'hapus' })
          .done(function(data) { $('body').append(data); });
      });
      $('#edit').click(function() {
          $.post('edit.php', { action: 'hapus' })
          .done(function(data) { $('.container').html(data); });
      });
    });
 </script>
 </body>
 </html>

 <?php

 function GetCountDB($files) {
    $open = fopen($files, "r");

    while(!feof($open)) {
      $c[] = fgets($open);
    }
    return count($c);
      fclose($open);
 }
 function GetValidParams($files, $str) {
    $open = fopen($files, "r");

    while(!feof($open)) {
      $c[] = fgets($open);
    }
    fclose($open);

  foreach ($c as $value) {
    if(strpos($value, $str)) {
      return true;
    } else {
      return false;
    }
  }

}
 ?>