<?php
require_once('dbconfig.php');
session_start();
require_once('session.php');

if(isset($_POST['add'])) {
	$now = new DateTime();
	$year = $now->format("Y");
	$month = $now->format("m");
	$day = $now->format("d");
	$params = $_POST['params'];
	$perbarui = $year . $month . $day;
	$delim = $_POST['delim'];
	$gaya	=	'';
	switch ($delim) {
		case '1':
			$gaya = '0,1';
			break;
		
		case '2':
			$gaya = '1,0';
			break;
	}
	if(isset($_POST['metod'])) {
		$metod = $_POST['metod'];
		if($metod == 'nodb') { goto lanjutaja; }
	} else { $metod = NULL; }

	$dbfile = $_FILES['dbfile']['tmp_name'];
	//$dbname = $_FILES['dbfile']['name'];
	$dbsize = $_FILES['dbfile']['size'];
	$ext = pathinfo($_FILES['dbfile']['name'], PATHINFO_EXTENSION);
	if($ext != 'txt') { die("<script>alert('Database harus .txt'); window.location = 'manage.php';</script>"); ;}
	$params = $_POST['params'];
	$dbname = $eid . '.txt';
	$local_upload = '../dbEngine/' . $dbname;


	//if(!file_exists($local_upload) ) {
		if(move_uploaded_file($dbfile, $local_upload)) {
			//echo "<script>alert('Berhasil'); window.location = 'manage.php'; </script>";	
			goto lanjut;
			
		} else {
			die("<script>alert('Gagal di upload'); </script>");
		}
	//} //else {
			//die("<script>alert('File sudah ada..'); window.history.back(); </script>");
	  //}

	lanjut:
if(!$metod != NULL) {
	$quer = $konek->query("INSERT INTO `data`(`ID`, `ENGINE`, `FILE`, `PARAMS`, `DELIM`, `PERBARUI`) VALUES ('$uid', '$projname', 'dbEngine/$dbname', '$params', '$gaya', '$perbarui')");
} else {
	$quer = $konek->query("UPDATE `data` SET ENGINE='$projname', FILE='dbEngine/$dbname', PARAMS='$params', DELIM='$gaya', PERBARUI='$perbarui' WHERE ID='$uid'");
}

lanjutaja :

	$quer = $konek->query("UPDATE `data` SET PARAMS='$params', DELIM='$gaya', PERBARUI='$perbarui' WHERE ID='$uid'");

	echo "<script>window.location = 'manage.php';</script>";
}

?>