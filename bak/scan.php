<script type="text/javascript">
	setTimeout(next, 5000);
	
	 function next() {
	 	$('#wait').hide();
	 	$('html, body').animate({ scrollTop: $("#caption").offset().top -75 }, 800);
	 	setTimeout(function() {$('#hasil').fadeIn('slow');}, 900);
	  
	 }
</script>

<?php 
if(!isset($_FILES['userfile'])) {die();}
	require_once('class/clsScan.php');
	$files 		= 	$_FILES['userfile']['tmp_name']; 
	$namefile 	= 	$_FILES['userfile']['name'];
	$sizefile	=	$_FILES['userfile']['size'];
	$hash 		= 	strtolower(md5_file($files));
	unlink($files); // Hapus dari temp file, karena cuma ngambil HASH nya doang kan
	$disallow 	=	array('iso','rar', 'zip', 'mp3', 'mp4', 'mpeg', 'mp3', 'mkv', 'ogg', '3gp', 'raw', 'wav');
	$ext 		= 	pathinfo($namefile, PATHINFO_EXTENSION);
	$ext 		= 	($ext != '') ? $ext : 'N/A';
	if(in_array($ext, $disallow)) {
		print('<blockquote>Error Extention..</blockquote><br>');
		goto loncat;
	}
	$clsGet 		=	new clsGet(); // Class untuk Get Database
		$av 		= 	$clsGet->GetEngine();
		$en 		= 	$clsGet->GetDbEngine();
		$params		= 	$clsGet->GetParams();
		$update		=	$clsGet->GetDBUpdate();
	foreach ($en as $key => $engine) {
		$clsScan = new clsScan($engine); // Engine Scan
		$resScan = $clsScan->ScanNow($hash, $params[$key]);
		$data[] 	= ($resScan != "Tidak ada") ? '<span style="color:#EE6E73;"><i class="fa fa-warning" ></i> '.$resScan.'</span>' : '<span style="color:#1D9D74;"><i class="fa fa-smile-o"></i> Safe!</span>' ;
		$ico[] = ($resScan != "Tidak ada") ? '<i style="color:#EE6E73;" title="Terdeteksi sebagai ancaman" class="material-icons">warning</i>' : '<i style="color:#1D9D74;" title="Aman" class="material-icons">verified_user</i>';
		
	} ?>
	<h4>File</h4>
	<div class="card-panel">
	<table style="font-size: 10.1pt;">
	  <tr>	
		<td width="95">Hash</td>
		<td width="5">:</td>
		<td><?php echo $hash; ?></td>
	  </tr>
	  <tr>	
		<td>File name</td>
		<td>:</td>
		<td><?php echo $namefile; ?></td>
	  </tr>
	  <tr>
	  	<td>File size</td>
	  	<td>:</td>
	  	<td><?php echo $sizefile . ' bytes'; ?></td>
	  </tr>
	  <tr>
	  	<td>Extention</td>
	  	<td>:</td>
	  	<td><?php echo $ext; ?></td>
	  </tr>
	</table>
	</div><br><br>
	        <h5 id="caption">Antivirus Detection</h5>
	<div id="hasil" style="display: none;">
	<div class="card-panel">
        <?php foreach ($data as $key => $val) : ?>
        <?php $scanav = $av[$key]; ?>
        <?php $dbupdate = $update[$key]; ?>
			  <ul class="collection">
				    <li class="collection-item avatar">
			    	    <i class="material-icons circle blue">flash_on</i>
	 		 		    <span class="title"><?php echo $scanav; ?></span>
 		    		    <p style="font-size: 12pt;"><?php echo $val; ?><br></p>
 		    		    <span class="light" style="font-size: 8pt;">Update : <?php echo $dbupdate; ?>
 					    <p class="secondary-content" style="cursor: pointer;"><?php echo $ico[$key]; ?></p>
				    </li>
			  </ul>
       <?php endforeach; loncat:?>
    </div>
    </div>
<center id="wait">Scanning...
 <div class="preloader-wrapper big active" >
    <div class="spinner-layer spinner-blue-only">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div><div class="gap-patch">
        <div class="circle"></div>
      </div><div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>
</center>   
          

</div>
  
</div>